{% extends "base.html" %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Data</title>
    <link rel="stylesheet" href="static/css/sharestyles.css">

</head>
<body>

<div class="main-content">
    <div class="share-container">
        <header>
            <h1>Share Your Data</h1>
            <p>Securely share your visualizations with specific people.</p>
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button id="tab-share-data" class="tab-button active" data-tab="share-data-content">
                Share Data
            </button>
            <button id="tab-manage-data" class="tab-button" data-tab="manage-data-content">
                Manage Shared Data
            </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content-area">

            <!-- Share Data Tab Content -->
            <div id="share-data-content" class="tab-pane active">
                <form method="POST" class="share-form">
                    {{ form.hidden_tag() }}

                <section class="content-section">
                    <h2>Select Visualizations to Share</h2>
                    <p class="section-subtitle">Choose which charts and insights you want to share</p>
                    <ul class="selection-list visualization-list">
                        <li>
                            <label for="viz1">
                                <input type="checkbox" name="selected_dataset_ids" id="viz1" value="steps">
                                <span class="item-details">
                                    <span class="item-name">Weekly Step Count</span>
                                    <span class="item-meta">Bar Chart</span>
                                </span>
                            </label>
                        </li>
                         <li>
                            
                            <label for="viz2">
                                <input type="checkbox"  name="selected_dataset_ids" id="viz2" value="sleep">
                                <span class="item-details">
                                    <span class="item-name">Sleep Patterns</span>
                                    <span class="item-meta">Line Chart</span>
                                </span>
                            </label>
                        </li>
                         <li>
                            <label for="viz3">
                                <input type="checkbox"  name="selected_dataset_ids" id="viz3" value="mood">
                                <span class="item-details">
                                    <span class="item-name">Mood Distribution</span>
                                    <span class="item-meta">Pie Chart</span>
                                </span>
                            </label>
                        </li>
                        <li>
                            <label for="viz4">
                                <input type="checkbox"  name="selected_dataset_ids" id="viz4" value="sleep_vs_mood">
                                <span class="item-details">
                                    <span class="item-name">Sleep vs Mood</span>
                                    <span class="item-meta">Line Chart</span>
                                </span>
                            </label>
                        </li>
                    </ul>
                </section>

                <section class="content-section">
                    <h2>Select Recipient</h2>
                    <p class="section-subtitle">Choose a contact or add a new one to share your selected visualizations with</p>
                    <div class="form-group mb-3">
                        <label for="selected_contact_id">Contact</label>
                        <select name="selected_contact_id" id="selected_contact_id" class="form-control" required onchange="toggleNewContactInput(this)">
                            <option value="" disabled selected>Select a contact</option>
                            {% for contact in contacts %}
                            <option value="{{ contact.id }}">{{ contact.name }} ({{ contact.email }})</option>
                            {% endfor %}
                            <option value="add_new">Add new contact by email...</option>
                        </select>
                    </div>
                    <div class="form-group mb-3" id="new-contact-fields" style="display:none;">
                        <label for="new_contact_name">Name</label>
                        <input type="text" name="new_contact_name" id="new_contact_name" class="form-control" placeholder="Enter name">
                        <label for="new_contact_email">Email</label>
                        <input type="email" name="new_contact_email" id="new_contact_email" class="form-control" placeholder="Enter email">
                    </div>
                    <ul>
                        {% for contact in contacts %}
                        <li>
                            <strong>{{ contact.name }}</strong> ({{ contact.email }})
                        </li>
                        {% else %}
                        <li>No contacts found.</li>
                        {% endfor %}
                    </ul>
                    </div>
                </section>
                <script>
                    function toggleNewContactInput(select) {
                        const newFields = document.getElementById('new-contact-fields');
                        if (select.value === 'add_new') {
                            newFields.style.display = 'block';
                            document.getElementById('new_contact_name').required = true;
                            document.getElementById('new_contact_email').required = true;
                        } else {
                            newFields.style.display = 'none';
                            document.getElementById('new_contact_name').required = false;
                            document.getElementById('new_contact_email').required = false;
                        }
                    }
                </script>

                <section class="content-section">
                    <label for="personalized-message" class="message-label">Personalized Message (Optional)</label>
                    <textarea id="personalized-message" name="personalized_message" rows="3" placeholder="I'd like to share my data insights with you. Check out these visualizations."></textarea>
                </section>

                 <!-- Share Actions Footer -->
                <footer>
                    <button class="btn btn-primary btn-share">
                        Share Now
                    </button>
                </footer>
            </div>

            <!-- Manage Shared Data Tab Content -->
            <div id="manage-data-content" class="tab-pane">
                <section class="content-section">
                    <h2>People With Access</h2>
                    <p class="section-subtitle">Manage who can see your shared visualizations</p>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Shared Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="icon person-icon">üë§</span> Jane Smith</td>
                                    <td><span class="icon email-icon">‚úâÔ∏è</span> jane@example.com</td>
                                    <td>2025-04-10</td>
                                    <td><span class="status status-viewed"><span class="icon status-icon">üü°</span> Viewed</span></td>
                                    <td><button class="btn-revoke"><span class="icon revoke-icon">‚äñ</span> Revoke</button></td>
                                </tr>
                                <tr>
                                    <td><span class="icon person-icon">üë§</span> John Doe</td>
                                    <td><span class="icon email-icon">‚úâÔ∏è</span> john@example.com</td>
                                    <td>2025-04-12</td>
                                    <td><span class="status status-pending"><span class="icon status-icon">‚ö™</span> Pending</span></td>
                                    <td><button class="btn-revoke"><span class="icon revoke-icon">‚äñ</span> Revoke</button></td>
                                </tr>
                                <tr>
                                    <td><span class="icon person-icon">üë§</span> Sarah Wilson</td>
                                    <td><span class="icon email-icon">‚úâÔ∏è</span> sarah@example.com</td>
                                    <td>2025-04-15</td>
                                    <td><span class="status status-accepted"><span class="icon status-icon">üü¢</span> Accepted</span></td>
                                    <td><button class="btn-revoke"><span class="icon revoke-icon">‚äñ</span> Revoke</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                 <section class="content-section">
                    <h2>Visualization Sharing Status</h2>
                    <p class="section-subtitle">Manage which visualizations are shared</p>
                     <div class="table-container">
                        <table class="data-table">
                             <thead>
                                <tr>
                                    <th>Visualization</th>
                                    <th>Type</th>
                                    <th>Created Date</th>
                                    <th>Shared</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Weekly Step Count</td>
                                    <td>Bar Chart</td>
                                    <td>2025-04-05</td>
                                    <td>Yes / Toggle</td> <!-- Example, replace with actual status/control -->
                                </tr>
                                 <tr>
                                    <td>Sleep Patterns</td>
                                    <td>Line Chart</td>
                                    <td>2025-04-08</td>
                                     <td>Yes / Toggle</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

<script>
    // Basic Tab Switching Logic
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTabId = button.getAttribute('data-tab');

            // Update button active states
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            // Update pane visibility
            tabPanes.forEach(pane => {
                if (pane.id === targetTabId) {
                    pane.classList.add('active');
                } else {
                    pane.classList.remove('active');
                }
            });
        });
    });

</script>
</body>
{% endblock %}