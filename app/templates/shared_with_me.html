{% extends "base.html" %} {% block content %}
<div class="flex flex-col lg:flex-row gap-6 p-6">
  <!-- LEFT SIDEBAR -->
  <div class="w-full lg:w-1/3 bg-white rounded-xl shadow p-5">
    <h2 class="text-2xl font-semibold text-gray-900 mb-1">
      People Sharing With You
    </h2>
    <p class="text-sm text-gray-500 mb-4">
      Select a user to view their shared data
    </p>

    <!-- Filter dropdown -->
    <div class="mb-4">
      <div class="flex items-center justify-between mb-4">
        <input
          type="text"
          id="search-box"
          placeholder="Search people..."
          class="w-2/3 px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500 text-sm"
        />
        <select
          id="filter-dropdown"
          class="w-1/3 px-3 py-2 border rounded-md border-gray-300 focus:ring-purple-500 focus:border-purple-500 text-sm ml-2"
        >
          <option value="all">All Data</option>
          <option value="steps">Steps</option>
          <option value="sleep">Sleep</option>
          <option value="mood">Mood</option>
        </select>
      </div>
    </div>

    <!-- User cards -->
    <div id="user-list" class="space-y-3">
      {% for user in shared_users %}
      <div
        class="user-card bg-gray-50 hover:bg-purple-50 border border-gray-200 rounded-lg p-4 cursor-pointer transition group"
        data-email="{{ user.email }}"
        data-name="{{ user.name }}"
        data-tags="weekly sleep mood"
      >
        <div class="flex items-center gap-3 mb-2">
          <div
            class="bg-purple-100 text-purple-800 font-bold rounded-full w-10 h-10 flex items-center justify-center"
          >
            {{ user.initials }}
          </div>
          <div>
            <p class="font-semibold text-sm text-gray-900">{{ user.name }}</p>
            <p class="text-xs text-gray-500">{{ user.email }}</p>
            <p class="text-xs text-gray-400">
              Shared since {{ user.shared_since.strftime('%Y-%m-%d') }}
            </p>
          </div>
        </div>
        <div class="flex flex-wrap gap-2 mt-1 text-xs">
          {% if user.email == 'jane@example.com' %}
          <span
            class="px-2 py-0.5 rounded-full text-xs font-medium text-gray-700 border border-gray-300 bg-purple-50 flex items-center gap-1"
          >
            <i class="ri-bar-chart-line"></i> Weekly
          </span>
          <span
            class="px-2 py-0.5 rounded-full text-xs font-medium text-gray-700 border border-gray-300 bg-blue-50 flex items-center gap-1"
          >
            <i class="ri-line-chart-line"></i> Sleep
          </span>
          <span
            class="px-2 py-0.5 rounded-full text-xs font-medium text-gray-700 border border-gray-300 bg-orange-50 flex items-center gap-1"
          >
            <i class="ri-emotion-line"></i> Mood
          </span>
          {% elif user.email == 'john@example.com' %}
          <span
            class="px-2 py-0.5 rounded-full text-xs font-medium text-gray-700 border border-gray-300 bg-blue-50 flex items-center gap-1"
          >
            <i class="ri-line-chart-line"></i> Sleep
          </span>
          {% elif user.email == 'sarah@example.com' %}
          <span
            class="px-2 py-0.5 rounded-full text-xs font-medium text-gray-700 border border-gray-300 bg-purple-50 flex items-center gap-1"
          >
            <i class="ri-bar-chart-line"></i> Weekly
          </span>
          <span
            class="px-2 py-0.5 rounded-full text-xs font-medium text-gray-700 border border-gray-300 bg-orange-50 flex items-center gap-1"
          >
            <i class="ri-emotion-line"></i> Mood
          </span>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- RIGHT CONTENT -->
  <div class="w-full lg:w-2/3 space-y-6">
    <!-- Placeholder if no user selected -->
    <div
      id="placeholder"
      class="flex flex-col items-center justify-center text-center bg-white border border-gray-200 rounded-xl shadow-md py-12 px-6 space-y-2"
    >
      <i class="ri-user-line text-5xl text-gray-300"></i>
      <p class="text-lg font-semibold text-gray-700">
        Select a user to view shared data
      </p>
      <p class="text-sm text-gray-500">
        Click on a user from the list on the left to view their shared charts
        and insights.
      </p>
    </div>

    <!-- Datasets Grid -->
    <div id="dataset-header-block" class="hidden">
      <h2 id="dataset-header" class="text-2xl font-semibold text-gray-900">
        Shared Datasets from Jane Smith
      </h2>
      <p class="text-sm text-gray-500 mb-4">
        Select a dataset to view the visualization
      </p>
    </div>
    <div id="dataset-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% for dataset in shared_datasets %}
      <div
        class="dataset-card bg-white border border-gray-200 rounded-lg shadow hover:shadow-md p-6 cursor-pointer transition-all"
        data-title="{{ dataset.title }}"
        data-chart="{{ dataset.chart_type }}"
      >
        <div class="flex justify-center mb-2">
          <div
            class="w-10 h-10 flex items-center justify-center rounded-full {% if dataset.chart_type == 'Bar Chart' %}bg-purple-100{% elif dataset.chart_type == 'Line Chart' %}bg-teal-100{% else %}bg-orange-100{% endif %}"
          >
            <i
              class="{% if dataset.chart_type == 'Bar Chart' %}ri-bar-chart-fill text-purple-500{% elif dataset.chart_type == 'Line Chart' %}ri-line-chart-fill text-teal-500{% else %}ri-pie-chart-2-fill text-orange-500{% endif %} text-xl"
            ></i>
          </div>
        </div>
        <p class="font-semibold text-gray-900">{{ dataset.title }}</p>
        <p class="text-sm text-gray-500">{{ dataset.chart_type }}</p>
      </div>
      {% endfor %}
    </div>

    <!-- Chart Viewer -->
    <div
      id="chart-section"
      class="hidden bg-white shadow rounded-xl p-6 space-y-4"
    >
      <button
        id="backBtn"
        class="text-purple-600 bg-purple-50 px-4 py-1 rounded-full text-sm font-semibold hover:bg-purple-100 transition"
      >
        &larr; Back to Datasets
      </button>
      <h3 id="chart-title" class="text-lg font-semibold text-gray-800"></h3>
      <canvas
        id="sharedChart"
        class="w-full min-h-[300px] max-h-[400px]"
      ></canvas>
      <div
        id="analysis-section"
        class="bg-white border border-gray-200 rounded-xl p-6 space-y-4"
      >
        <h3 class="text-xl font-semibold text-gray-900">Analysis</h3>
        <p class="text-sm text-gray-600">
          Insights from {{ selectedUser }}'s shared data
        </p>
        <div class="space-y-2">
          <div>
            <h4 class="text-sm font-semibold">Key Highlights</h4>
            <p class="text-sm text-gray-600">
              This dataset shows interesting patterns such as higher weekend
              activity and correlation between sleep and mood.
            </p>
          </div>
          <div>
            <h4 class="text-sm font-semibold">Comparison with Your Data</h4>
            <p class="text-sm text-gray-600">
              Compared to your patterns, this user has a higher average mood
              score and steadier sleep patterns.
            </p>
          </div>
          <div>
            <h4 class="text-sm font-semibold">Actionable Insights</h4>
            <p class="text-sm text-gray-600">
              Try maintaining consistent sleep durations and active weekends to
              match their improvement.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div
  id="toast"
  class="hidden fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow text-sm z-50"
></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/shared_with_me.js') }}"></script>
{% endblock %}
